(window.webpackJsonp=window.webpackJsonp||[]).push([[9],{288:function(e,r,o){e.exports=o.p+"assets/img/node-2-1.56817fdf.png"},317:function(e,r,o){"use strict";o.r(r);var t=o(38),s=Object(t.a)({},function(){var e=this,r=e.$createElement,t=e._self._c||r;return t("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[t("h1",{attrs:{id:"node如何管理多线程"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#node如何管理多线程","aria-hidden":"true"}},[e._v("#")]),e._v(" node如何管理多线程")]),e._v(" "),t("p",[e._v("nodejs是在主线程执行的，其他的异步IO和事件驱动相关的线程是通过libuv来实现内部的线程池和线程调度的。libuv存在着一个Event Loop,通过 Event Loop（事件循环）来切换实现类似多线程的效果。Event Loop 是维持一个执行栈和一个事件队列，在执行栈中，如果有异步IO及定时器等函数的话，就把这些异步回调函数放入到事件队列中。等执行栈执行完成后，会从事件队列中，按照一定的顺序执行事件队列中的异步回调函数。")]),e._v(" "),t("p",[e._v("nodeJS中的单线程是指js引擎只在唯一的主线程上运行的。其他的异步操作是有独立的线程去执行。通过libuv的Event Loop实现了类似多线程的上下文切换以及线程池的调度。线程是最小的进程，因此node也是单进程的。")]),e._v(" "),t("h2",{attrs:{id:"nodejs的实现多进程架构"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#nodejs的实现多进程架构","aria-hidden":"true"}},[e._v("#")]),e._v(" NodeJS的实现多进程架构")]),e._v(" "),t("p",[e._v("如上第四点，面对单线程单进程对多核使用率不好的问题，因此我们使用多进程，每个进程使用一个cpu，因此我们就可以实现多核cpu的利用。\nNode提供了child_process模块和cluster模块来实现多进程以及进程的管理。也就是我们常说的 Master-Worker模式。也就是说进程分为Master(主)进程 和 worker（工作）进程。master进程负责调度或管理worker进程，那么worker进程负责具体的业务处理。在服务器层面来讲，worker可以是一个服务进程，负责出来自于客户端的请求，多个worker就相当于多个服务器，因此就构成了一个服务器群。master进程则负责创建worker，接收客户端的请求，然后分配到各个服务器上去处理，并且监控worker进程的运行状态及进行管理操作。")]),e._v(" "),t("p",[e._v("如下图所示：\n"),t("img",{attrs:{src:o(288),alt:""}})]),e._v(" "),t("p",[e._v("上创建了4个worker进程后，现在我们需要考虑的是如何实现"),t("code",[e._v("master")]),e._v("进程与"),t("code",[e._v("worker")]),e._v("进程通信的问题。")]),e._v(" "),t("p",[e._v("在NodeJS中父子进程之间通信可以通过 "),t("code",[e._v("on('message')")]),e._v(" 和 "),t("code",[e._v("send()")]),e._v("方法来实现通信，"),t("code",[e._v("on('message')")]),e._v(" 是监听"),t("code",[e._v("message")]),e._v("事件的。")]),e._v(" "),t("p",[e._v("当该进程收到其他进程发送的消息时候，便会触发"),t("code",[e._v("message")]),e._v("事件。"),t("code",[e._v("send()")]),e._v("方法则是用于向其他进程发送消息的。")]),e._v(" "),t("p",[t("a",{attrs:{href:"https://www.cnblogs.com/tugenhua0707/p/11141076.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("原文链接"),t("OutboundLink")],1)])])},[],!1,null,null,null);r.default=s.exports}}]);