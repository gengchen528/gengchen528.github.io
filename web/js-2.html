<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>call/apply/bind对比及手写 | 雷欧的前端客栈</title>
    <meta name="description" content="前端客栈,带你走进全栈进阶之路,vue学习,react学习,Node,最新的全栈学习资源">
    <link rel="icon" href="/web-inn/img/logo.ico">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
  <meta name="keywords" content="前端客栈,小K博客,小k博客,前端,Node,Vue,React,2020最新前端资讯,2020前端技术合集,2020前端,Vue SSR,Nuxt,Nuxtjs">
    
    <link rel="preload" href="/web-inn/assets/css/0.styles.9314e462.css" as="style"><link rel="preload" href="/web-inn/assets/js/app.c8204003.js" as="script"><link rel="preload" href="/web-inn/assets/js/3.b3decb7d.js" as="script"><link rel="preload" href="/web-inn/assets/js/1.b7f29f9d.js" as="script"><link rel="preload" href="/web-inn/assets/js/10.12ba8c85.js" as="script"><link rel="prefetch" href="/web-inn/assets/js/11.165310ea.js"><link rel="prefetch" href="/web-inn/assets/js/12.fd81af58.js"><link rel="prefetch" href="/web-inn/assets/js/13.56ba4f79.js"><link rel="prefetch" href="/web-inn/assets/js/14.9be3cf6f.js"><link rel="prefetch" href="/web-inn/assets/js/15.4cc17da9.js"><link rel="prefetch" href="/web-inn/assets/js/16.952fd54e.js"><link rel="prefetch" href="/web-inn/assets/js/17.1f589473.js"><link rel="prefetch" href="/web-inn/assets/js/18.94c71827.js"><link rel="prefetch" href="/web-inn/assets/js/19.55903c09.js"><link rel="prefetch" href="/web-inn/assets/js/20.e9d1790a.js"><link rel="prefetch" href="/web-inn/assets/js/21.49651b25.js"><link rel="prefetch" href="/web-inn/assets/js/22.58360267.js"><link rel="prefetch" href="/web-inn/assets/js/23.a0f0915f.js"><link rel="prefetch" href="/web-inn/assets/js/24.d6f3814d.js"><link rel="prefetch" href="/web-inn/assets/js/25.86dc3da2.js"><link rel="prefetch" href="/web-inn/assets/js/26.9db65791.js"><link rel="prefetch" href="/web-inn/assets/js/27.042044cb.js"><link rel="prefetch" href="/web-inn/assets/js/28.85052dbf.js"><link rel="prefetch" href="/web-inn/assets/js/29.65b0f585.js"><link rel="prefetch" href="/web-inn/assets/js/30.f34e8200.js"><link rel="prefetch" href="/web-inn/assets/js/31.ec8a93d6.js"><link rel="prefetch" href="/web-inn/assets/js/32.e265c1bd.js"><link rel="prefetch" href="/web-inn/assets/js/33.f3ec6091.js"><link rel="prefetch" href="/web-inn/assets/js/34.7498928f.js"><link rel="prefetch" href="/web-inn/assets/js/35.91910561.js"><link rel="prefetch" href="/web-inn/assets/js/36.6171fdcd.js"><link rel="prefetch" href="/web-inn/assets/js/37.c6a8de37.js"><link rel="prefetch" href="/web-inn/assets/js/38.3973d704.js"><link rel="prefetch" href="/web-inn/assets/js/39.53b952a8.js"><link rel="prefetch" href="/web-inn/assets/js/4.a1635905.js"><link rel="prefetch" href="/web-inn/assets/js/5.591eb380.js"><link rel="prefetch" href="/web-inn/assets/js/6.072d5ff6.js"><link rel="prefetch" href="/web-inn/assets/js/7.bae679da.js"><link rel="prefetch" href="/web-inn/assets/js/8.1ced2cff.js"><link rel="prefetch" href="/web-inn/assets/js/9.b26abebe.js">
    <link rel="stylesheet" href="/web-inn/assets/css/0.styles.9314e462.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/web-inn/" class="home-link router-link-active"><!----> <span class="site-name">雷欧的前端客栈</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/web-inn/" class="nav-link">首页</a></div><div class="nav-item"><a href="/web-inn/blog/" class="nav-link">博文</a></div><div class="nav-item"><a href="/web-inn/web/" class="nav-link router-link-active">前端</a></div><div class="nav-item"><a href="/web-inn/node/" class="nav-link">Node</a></div><div class="nav-item"><a href="/web-inn/onlineTool/markdown-online.html" class="nav-link">Markdown在线编辑器</a></div><div class="nav-item"><a href="/web-inn/wechatBot/" class="nav-link">微信每日说</a></div><div class="nav-item"><a href="/web-inn/secretary/" class="nav-link">智能微秘书</a></div><div class="nav-item"><a href="https://github.com/gengchen528/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/web-inn/" class="nav-link">首页</a></div><div class="nav-item"><a href="/web-inn/blog/" class="nav-link">博文</a></div><div class="nav-item"><a href="/web-inn/web/" class="nav-link router-link-active">前端</a></div><div class="nav-item"><a href="/web-inn/node/" class="nav-link">Node</a></div><div class="nav-item"><a href="/web-inn/onlineTool/markdown-online.html" class="nav-link">Markdown在线编辑器</a></div><div class="nav-item"><a href="/web-inn/wechatBot/" class="nav-link">微信每日说</a></div><div class="nav-item"><a href="/web-inn/secretary/" class="nav-link">智能微秘书</a></div><div class="nav-item"><a href="https://github.com/gengchen528/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>css基础</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>js基础</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/web-inn/web/js-1.html" class="sidebar-link">原型与原型链详解</a></li><li><a href="/web-inn/web/js-2.html" class="active sidebar-link">call/apply/bind对比及手写</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/web-inn/web/js-2.html#call-apply-bind的基本介绍" class="sidebar-link">call,apply,bind的基本介绍</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/web-inn/web/js-2.html#语法：" class="sidebar-link">语法：</a></li><li class="sidebar-sub-header"><a href="/web-inn/web/js-2.html#返回值：" class="sidebar-link">返回值：</a></li><li class="sidebar-sub-header"><a href="/web-inn/web/js-2.html#参数" class="sidebar-link">参数:</a></li><li class="sidebar-sub-header"><a href="/web-inn/web/js-2.html#调用call-apply-bind的必须是个函数" class="sidebar-link">调用call/apply/bind的必须是个函数</a></li><li class="sidebar-sub-header"><a href="/web-inn/web/js-2.html#作用：" class="sidebar-link">作用：</a></li><li class="sidebar-sub-header"><a href="/web-inn/web/js-2.html#如何不弄混call和apply" class="sidebar-link">如何不弄混call和apply</a></li><li class="sidebar-sub-header"><a href="/web-inn/web/js-2.html#区别：" class="sidebar-link">区别：</a></li></ul></li><li class="sidebar-sub-header"><a href="/web-inn/web/js-2.html#call和apply的应用场景" class="sidebar-link">call和apply的应用场景</a></li><li class="sidebar-sub-header"><a href="/web-inn/web/js-2.html#call、apply改用哪个" class="sidebar-link">call、apply改用哪个</a></li><li class="sidebar-sub-header"><a href="/web-inn/web/js-2.html#bind的应用场景" class="sidebar-link">bind的应用场景</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/web-inn/web/js-2.html#保存函数参数" class="sidebar-link">保存函数参数</a></li></ul></li><li class="sidebar-sub-header"><a href="/web-inn/web/js-2.html#回调函数this丢失问题" class="sidebar-link">回调函数this丢失问题</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/web-inn/web/js-2.html#回调函数this为何会丢失？" class="sidebar-link">回调函数this为何会丢失？</a></li><li class="sidebar-sub-header"><a href="/web-inn/web/js-2.html#回调函数this丢失的解决方案：" class="sidebar-link">回调函数this丢失的解决方案：</a></li></ul></li><li class="sidebar-sub-header"><a href="/web-inn/web/js-2.html#中高级面试题-手写call-apply、bind" class="sidebar-link">中高级面试题-手写call/apply、bind</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/web-inn/web/js-2.html#你能手写实现一个call吗？" class="sidebar-link">你能手写实现一个call吗？</a></li><li class="sidebar-sub-header"><a href="/web-inn/web/js-2.html#你能手写实现一个apply吗？" class="sidebar-link">你能手写实现一个apply吗？</a></li><li class="sidebar-sub-header"><a href="/web-inn/web/js-2.html#你能手写实现一个bind吗？" class="sidebar-link">你能手写实现一个bind吗？</a></li></ul></li></ul></li><li><a href="/web-inn/web/js-3.html" class="sidebar-link">继承实现的几种方式</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="call-apply-bind对比及手写"><a href="#call-apply-bind对比及手写" aria-hidden="true" class="header-anchor">#</a> call/apply/bind对比及手写</h1> <p>原文链接：<a href="https://juejin.im/post/5d469e0851882544b85c32ef" target="_blank" rel="noopener noreferrer">https://juejin.im/post/5d469e0851882544b85c32ef<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h2 id="call-apply-bind的基本介绍"><a href="#call-apply-bind的基本介绍" aria-hidden="true" class="header-anchor">#</a> call,apply,bind的基本介绍</h2> <h3 id="语法："><a href="#语法：" aria-hidden="true" class="header-anchor">#</a> 语法：</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">fun</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>thisArg<span class="token punctuation">,</span> param1<span class="token punctuation">,</span> param2<span class="token punctuation">,</span> <span class="token operator">...</span><span class="token punctuation">)</span>
<span class="token function">fun</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>thisArg<span class="token punctuation">,</span> <span class="token punctuation">[</span>param1<span class="token punctuation">,</span>param2<span class="token punctuation">,</span><span class="token operator">...</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token function">fun</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>thisArg<span class="token punctuation">,</span> param1<span class="token punctuation">,</span> param2<span class="token punctuation">,</span> <span class="token operator">...</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="返回值："><a href="#返回值：" aria-hidden="true" class="header-anchor">#</a> 返回值：</h3> <p><code>call/apply</code>：<code>fun</code>执行的结果
<code>bind</code>：返回<code>fun</code>的拷贝，并拥有指定的<code>this</code>值和初始参数</p> <h3 id="参数"><a href="#参数" aria-hidden="true" class="header-anchor">#</a> 参数:</h3> <p>thisArg(可选):</p> <p><code>fun</code>的<code>thi</code>s指向<code>thisArg</code>对象
非严格模式下：<code>thisArg</code>指定为<code>null</code>，<code>undefined</code>，<code>fun</code>中的<code>this</code>指向<code>window</code>对象.
严格模式下：<code>fun</code>的<code>this</code>为<code>undefined</code>
值为原始值(数字，字符串，布尔值)的this会指向该原始值的自动包装对象，如 <code>String</code>、<code>Number</code>、<code>Boolean</code></p> <p>param1,param2(可选): 传给fun的参数。</p> <p>1、如果param不传或为 <code>null</code>/<code>undefined</code>，则表示不需要传入任何参数.
2、apply第二个参数为数组，数组内的值为传给<code>fun</code>的参数。</p> <h3 id="调用call-apply-bind的必须是个函数"><a href="#调用call-apply-bind的必须是个函数" aria-hidden="true" class="header-anchor">#</a> 调用call/apply/bind的必须是个函数</h3> <p><code>call</code>、<code>apply</code>和<code>bind</code>是挂在Function对象上的三个方法,只有函数才有这些方法。
只要是函数就可以，比如: <code>Object.prototype.toString</code>就是个函数，我们经常看到这样的用法：<code>Object.prototype.toString.call(data)</code></p> <h3 id="作用："><a href="#作用：" aria-hidden="true" class="header-anchor">#</a> 作用：</h3> <p>改变函数执行时的this指向，目前所有关于它们的运用，都是基于这一点来进行的。</p> <h3 id="如何不弄混call和apply"><a href="#如何不弄混call和apply" aria-hidden="true" class="header-anchor">#</a> 如何不弄混call和apply</h3> <blockquote><p>弄混这两个API的不在少数，不要小看这个问题，记住下面的这个方法就好了。</p></blockquote> <p><code>apply</code>是以<code>a</code>开头，它传给<code>fun</code>的参数是<code>Array</code>，也是以<code>a</code>开头的。</p> <h3 id="区别："><a href="#区别：" aria-hidden="true" class="header-anchor">#</a> 区别：</h3> <h4 id="call与apply的唯一区别"><a href="#call与apply的唯一区别" aria-hidden="true" class="header-anchor">#</a> call与apply的唯一区别</h4> <p>传给<code>fun</code>的参数写法不同：</p> <p><code>apply</code>是第2个参数，这个参数是一个数组：传给<code>fun</code>参数都写在数组中。
<code>call</code>从第2~n的参数都是传给<code>fun</code>的。</p> <h4 id="call-apply与bind的区别"><a href="#call-apply与bind的区别" aria-hidden="true" class="header-anchor">#</a> call/apply与bind的区别</h4> <p>执行：</p> <p><code>call</code>/<code>apply</code>改变了函数的this上下文后马上执行该函数
<code>bind</code>则是返回改变了上下文后的函数,不执行该函数</p> <p>返回值:</p> <p><code>call</code>/<code>apply</code> 返回<code>fun</code>的执行结果
<code>bind</code>返回<code>fun</code>的拷贝，并指定了<code>fun</code>的<code>this</code>指向，保存了<code>fun</code>的参数。</p> <p>返回值这段在下方<code>bind</code>应用中有详细的示例解析</p> <h2 id="call和apply的应用场景"><a href="#call和apply的应用场景" aria-hidden="true" class="header-anchor">#</a> call和apply的应用场景</h2> <blockquote><p>这些应用场景，多加体会就可以发现它们的理念都是：借用方法</p></blockquote> <p>1、判断数据类型：</p> <p><code>Object.prototype.toString</code>用来判断类型再合适不过，借用它我们几乎可以判断所有类型的数据：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">isType</span><span class="token punctuation">(</span><span class="token parameter">data<span class="token punctuation">,</span> type</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> typeObj <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token string">'[object String]'</span><span class="token punctuation">:</span> <span class="token string">'string'</span><span class="token punctuation">,</span>
        <span class="token string">'[object Number]'</span><span class="token punctuation">:</span> <span class="token string">'number'</span><span class="token punctuation">,</span>
        <span class="token string">'[object Boolean]'</span><span class="token punctuation">:</span> <span class="token string">'boolean'</span><span class="token punctuation">,</span>
        <span class="token string">'[object Null]'</span><span class="token punctuation">:</span> <span class="token string">'null'</span><span class="token punctuation">,</span>
        <span class="token string">'[object Undefined]'</span><span class="token punctuation">:</span> <span class="token string">'undefined'</span><span class="token punctuation">,</span>
        <span class="token string">'[object Object]'</span><span class="token punctuation">:</span> <span class="token string">'object'</span><span class="token punctuation">,</span>
        <span class="token string">'[object Array]'</span><span class="token punctuation">:</span> <span class="token string">'array'</span><span class="token punctuation">,</span>
        <span class="token string">'[object Function]'</span><span class="token punctuation">:</span> <span class="token string">'function'</span><span class="token punctuation">,</span>
        <span class="token string">'[object Date]'</span><span class="token punctuation">:</span> <span class="token string">'date'</span><span class="token punctuation">,</span> <span class="token comment">// Object.prototype.toString.call(new Date())</span>
        <span class="token string">'[object RegExp]'</span><span class="token punctuation">:</span> <span class="token string">'regExp'</span><span class="token punctuation">,</span>
        <span class="token string">'[object Map]'</span><span class="token punctuation">:</span> <span class="token string">'map'</span><span class="token punctuation">,</span>
        <span class="token string">'[object Set]'</span><span class="token punctuation">:</span> <span class="token string">'set'</span><span class="token punctuation">,</span>
        <span class="token string">'[object HTMLDivElement]'</span><span class="token punctuation">:</span> <span class="token string">'dom'</span><span class="token punctuation">,</span> <span class="token comment">// document.querySelector('#app')</span>
        <span class="token string">'[object WeakMap]'</span><span class="token punctuation">:</span> <span class="token string">'weakMap'</span><span class="token punctuation">,</span>
        <span class="token string">'[object Window]'</span><span class="token punctuation">:</span> <span class="token string">'window'</span><span class="token punctuation">,</span>  <span class="token comment">// Object.prototype.toString.call(window)</span>
        <span class="token string">'[object Error]'</span><span class="token punctuation">:</span> <span class="token string">'error'</span><span class="token punctuation">,</span> <span class="token comment">// new Error('1')</span>
        <span class="token string">'[object Arguments]'</span><span class="token punctuation">:</span> <span class="token string">'arguments'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">let</span> name <span class="token operator">=</span> <span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token comment">// 借用Object.prototype.toString()获取数据类型</span>
    <span class="token keyword">let</span> typeName <span class="token operator">=</span> typeObj<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token string">'未知类型'</span> <span class="token comment">// 匹配数据类型</span>
    <span class="token keyword">return</span> typeName <span class="token operator">===</span> type <span class="token comment">// 判断该数据类型是否为传入的类型</span>
<span class="token punctuation">}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>
    <span class="token function">isType</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">'object'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// true</span>
    <span class="token function">isType</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'array'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// true</span>
    <span class="token function">isType</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'object'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// false</span>
    <span class="token function">isType</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'date'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// true</span>
<span class="token punctuation">)</span>
</code></pre></div><p>2、类数组借用数组的方法：</p> <p>类数组因为不是真正的数组所有没有数组类型上自带的种种方法，所以我们需要去借用数组的方法。
比如借用数组的push方法：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> arrayLike <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token number">0</span><span class="token punctuation">:</span> <span class="token string">'OB'</span><span class="token punctuation">,</span>
  <span class="token number">1</span><span class="token punctuation">:</span> <span class="token string">'Koro1'</span><span class="token punctuation">,</span>
  length<span class="token punctuation">:</span> <span class="token number">2</span>
<span class="token punctuation">}</span>
<span class="token class-name">Array</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>arrayLike<span class="token punctuation">,</span> <span class="token string">'添加元素1'</span><span class="token punctuation">,</span> <span class="token string">'添加元素2'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arrayLike<span class="token punctuation">)</span> <span class="token comment">// {&quot;0&quot;:&quot;OB&quot;,&quot;1&quot;:&quot;Koro1&quot;,&quot;2&quot;:&quot;添加元素1&quot;,&quot;3&quot;:&quot;添加元素2&quot;,&quot;length&quot;:4}</span>
</code></pre></div><p>3、apply获取数组最大值最小值：</p> <p>apply直接传递数组做要调用方法的参数，也省一步展开数组，比如使用Math.max、Math.min来获取数组的最大值/最小值:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> max <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>Math<span class="token punctuation">,</span> arr<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 16</span>
<span class="token keyword">const</span> min <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>Math<span class="token punctuation">,</span> arr<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 6</span>
</code></pre></div><p>4、继承</p> <p>ES5的继承也都是通过借用父类的构造方法来实现父类方法/属性的继承：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 父类</span>
<span class="token keyword">function</span> <span class="token function">supFather</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>colors <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'red'</span><span class="token punctuation">,</span> <span class="token string">'blue'</span><span class="token punctuation">,</span> <span class="token string">'green'</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 复杂类型</span>
<span class="token punctuation">}</span>
supFather<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">sayName</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">age</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">,</span> <span class="token string">'age'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// 子类</span>
<span class="token keyword">function</span> <span class="token function">sub</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> age</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 借用父类的方法：修改它的this指向,赋值父类的构造函数里面方法、属性到子类上</span>
    <span class="token function">supFather</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>age <span class="token operator">=</span> age<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// 重写子类的prototype，修正constructor指向</span>
<span class="token keyword">function</span> <span class="token function">inheritPrototype</span><span class="token punctuation">(</span><span class="token parameter">sonFn<span class="token punctuation">,</span> fatherFn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    sonFn<span class="token punctuation">.</span>prototype <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>fatherFn<span class="token punctuation">.</span>prototype<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 继承父类的属性以及方法</span>
    sonFn<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>constructor <span class="token operator">=</span> sonFn<span class="token punctuation">;</span> <span class="token comment">// 修正constructor指向到继承的那个函数上</span>
<span class="token punctuation">}</span>
<span class="token function">inheritPrototype</span><span class="token punctuation">(</span>sub<span class="token punctuation">,</span> supFather<span class="token punctuation">)</span><span class="token punctuation">;</span>
sub<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">sayAge</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>age<span class="token punctuation">,</span> <span class="token string">'foo'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// 实例化子类，可以在实例上找到属性、方法</span>
<span class="token keyword">const</span> instance1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">sub</span><span class="token punctuation">(</span><span class="token string">&quot;OBKoro1&quot;</span><span class="token punctuation">,</span> <span class="token number">24</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> instance2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">sub</span><span class="token punctuation">(</span><span class="token string">&quot;小明&quot;</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
instance1<span class="token punctuation">.</span>colors<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">'black'</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>instance1<span class="token punctuation">)</span> <span class="token comment">// {&quot;name&quot;:&quot;OBKoro1&quot;,&quot;colors&quot;:[&quot;red&quot;,&quot;blue&quot;,&quot;green&quot;,&quot;black&quot;],&quot;age&quot;:24}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>instance2<span class="token punctuation">)</span> <span class="token comment">// {&quot;name&quot;:&quot;小明&quot;,&quot;colors&quot;:[&quot;red&quot;,&quot;blue&quot;,&quot;green&quot;],&quot;age&quot;:18} </span>
</code></pre></div><p>类似的应用场景还有很多，就不赘述了，关键在于它们借用方法的理念，不理解的话多看几遍。</p> <h2 id="call、apply改用哪个"><a href="#call、apply改用哪个" aria-hidden="true" class="header-anchor">#</a> call、apply改用哪个</h2> <p>call,apply的效果完全一样，它们的区别也在于</p> <p>参数数量/顺序确定就用call，参数数量/顺序不确定的话就用apply。</p> <p>考虑可读性：参数数量不多就用call，参数数量比较多的话，把参数整合成数组，使用apply。</p> <p>参数集合已经是一个数组的情况，用apply，比如上文的获取数组最大值/最小值。</p> <p>参数数量/顺序不确定的话就用apply，比如以下示例：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
    age<span class="token punctuation">:</span> <span class="token number">24</span><span class="token punctuation">,</span>
    name<span class="token punctuation">:</span> <span class="token string">'OBKoro1'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> obj2 <span class="token operator">=</span> <span class="token punctuation">{</span>
    age<span class="token punctuation">:</span> <span class="token number">777</span>
<span class="token punctuation">}</span>
<span class="token function">callObj</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> handle<span class="token punctuation">)</span>
<span class="token function">callObj</span><span class="token punctuation">(</span>obj2<span class="token punctuation">,</span> handle<span class="token punctuation">)</span>
<span class="token comment">// 根据某些条件来决定要传递参数的数量、以及顺序</span>
<span class="token keyword">function</span> <span class="token function">callObj</span><span class="token punctuation">(</span><span class="token parameter">thisAge<span class="token punctuation">,</span> fn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> params <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>thisAge<span class="token punctuation">.</span>name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        params<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>thisAge<span class="token punctuation">.</span>name<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>thisAge<span class="token punctuation">.</span>age<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        params<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>thisAge<span class="token punctuation">.</span>age<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token function">fn</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>thisAge<span class="token punctuation">,</span> params<span class="token punctuation">)</span> <span class="token comment">// 数量和顺序不确定 不能使用call</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">handle</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>params</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'params'</span><span class="token punctuation">,</span> params<span class="token punctuation">)</span> <span class="token comment">// do some thing</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="bind的应用场景"><a href="#bind的应用场景" aria-hidden="true" class="header-anchor">#</a> bind的应用场景</h2> <h3 id="保存函数参数"><a href="#保存函数参数" aria-hidden="true" class="header-anchor">#</a> 保存函数参数</h3> <p>首先来看下一道经典的面试题：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">5</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token comment">// 依次输出：6 6 6 6 6</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> i <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>造成这个现象的原因是等到setTimeout异步执行时,i已经变成6了。</p> <p>关于js事件循环机制不理解的同学，可以看我这篇博客：Js 的事件循环(Event Loop)机制以及实例讲解</p> <p>那么如何使他输出: 1,2,3,4,5呢？</p> <p>方法有很多：</p> <p>1、闭包, 保存变量</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">5</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">i</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'闭包:'</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 依次输出：1 2 3 4 5</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> i <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>在这里创建了一个闭包，每次循环都会把i的最新值传进去，然后被闭包保存起来。</p> <p>2、bind</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">5</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 缓存参数</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">i</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'bind'</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span> <span class="token comment">// 依次输出：1 2 3 4 5</span>
    <span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">,</span> i <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>实际上这里也用了闭包，我们知道bind会返回一个函数，这个函数也是闭包。</p> <p>它保存了函数的this指向、初始参数，每次i的变更都会被bind的闭包存起来，所以输出1-5。</p> <p>具体细节，下面有个手写bind方法，研究一下，就能搞懂了。</p> <p>3、let</p> <p>用let声明i也可以输出1-5: 因为let是块级作用域,所以每次都会创建一个新的变量,所以setTimeout每次读的值都是不同的,详解。</p> <h2 id="回调函数this丢失问题"><a href="#回调函数this丢失问题" aria-hidden="true" class="header-anchor">#</a> 回调函数this丢失问题</h2> <p>这是一个常见的问题，下面是我在开发VSCode插件处理webview通信时，遇到的真实问题，一开始以为VSCode的API哪里出问题，调试了一番才发现是this指向丢失的问题。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Page</span> <span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">callBack</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>className <span class="token operator">=</span> <span class="token string">'Page'</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>MessageCallBack <span class="token operator">=</span> callBack <span class="token comment">// </span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">MessageCallBack</span><span class="token punctuation">(</span><span class="token string">'发给注册页面的信息'</span><span class="token punctuation">)</span> <span class="token comment">// 执行PageA的回调函数</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">PageA</span> <span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>className <span class="token operator">=</span> <span class="token string">'PageA'</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>pageClass <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Page</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>handleMessage<span class="token punctuation">)</span> <span class="token comment">// 注册页面 传递回调函数 问题在这里</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 与页面通信回调</span>
    <span class="token function">handleMessage</span><span class="token punctuation">(</span><span class="token parameter">msg</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'处理通信'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>className<span class="token punctuation">,</span> msg<span class="token punctuation">)</span> <span class="token comment">//  'Page' this指向错误</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">new</span> <span class="token class-name">PageA</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="回调函数this为何会丢失？"><a href="#回调函数this为何会丢失？" aria-hidden="true" class="header-anchor">#</a> 回调函数this为何会丢失？</h3> <p>显然声明的时候不会出现问题，执行回调函数的时候也不可能出现问题。</p> <p>问题出在传递回调函数的时候：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">this</span><span class="token punctuation">.</span>pageClass <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Page</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>handleMessage<span class="token punctuation">)</span>
</code></pre></div><p>因为传递过去的this.handleMessage是一个函数内存地址，没有上下文对象，也就是说该函数没有绑定它的this指向。</p> <p>那它的this指向于它所应用的绑定规则：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Page</span> <span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">callBack</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>className <span class="token operator">=</span> <span class="token string">'Page'</span>
        <span class="token comment">// callBack() // 直接执行的话 由于class 内部是严格模式，所以this 实际指向的是 undefined</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>MessageCallBack <span class="token operator">=</span> callBack <span class="token comment">// 回调函数的this 隐式绑定到class page</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">MessageCallBack</span><span class="token punctuation">(</span><span class="token string">'发给注册页面的信息'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>既然知道问题了，那我们只要绑定回调函数的this指向为PageA就解决问题了。</p> <h3 id="回调函数this丢失的解决方案："><a href="#回调函数this丢失的解决方案：" aria-hidden="true" class="header-anchor">#</a> 回调函数this丢失的解决方案：</h3> <p>bind绑定回调函数的this指向：</p> <p>这是典型bind的应用场景, 绑定this指向，用做回调函数。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">this</span><span class="token punctuation">.</span>pageClass <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Page</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">handleMessage</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 绑定回调函数的this指向</span>
</code></pre></div><p><em><strong>PS： 这也是为什么react的render函数在绑定回调函数的时候，也要使用bind绑定一下this的指向，也是因为同样的问题以及原理。</strong></em></p> <p>箭头函数绑定this指向</p> <p>箭头函数的this指向定义的时候外层第一个普通函数的this，在这里指的是class类：PageA</p> <p>这块内容，可以看下我之前写的博客：详解箭头函数和普通函数的区别以及<a href="https://juejin.im/post/5c76972af265da2dc4538b64#heading-3" target="_blank" rel="noopener noreferrer">《箭头函数的注意事项、不适用场景》<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">this</span><span class="token punctuation">.</span>pageClass <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Page</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">handleMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 箭头函数绑定this指向</span>
</code></pre></div><h2 id="中高级面试题-手写call-apply、bind"><a href="#中高级面试题-手写call-apply、bind" aria-hidden="true" class="header-anchor">#</a> 中高级面试题-手写call/apply、bind</h2> <p>在大厂的面试中，手写实现call,apply,bind(特别是bind)一直是比较高频的面试题，在这里我们也一起来实现一下这几个函数。</p> <h3 id="你能手写实现一个call吗？"><a href="#你能手写实现一个call吗？" aria-hidden="true" class="header-anchor">#</a> 你能手写实现一个call吗？</h3> <h4 id="思路"><a href="#思路" aria-hidden="true" class="header-anchor">#</a> 思路</h4> <ol><li><p>根据call的规则设置上下文对象,也就是this的指向。</p></li> <li><p>通过设置context的属性,将函数的this指向隐式绑定到context上</p></li> <li><p>通过隐式绑定执行函数并传递参数。</p></li> <li><p>删除临时属性，返回函数执行结果</p></li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token class-name">Function</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">myCall</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">context<span class="token punctuation">,</span> <span class="token operator">...</span>arr</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>context <span class="token operator">===</span> <span class="token keyword">null</span> <span class="token operator">||</span> context <span class="token operator">===</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token comment">// 指定为 null 和 undefined 的 this 值会自动指向全局对象(浏览器中为window)</span>
        context <span class="token operator">=</span> window 
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        context <span class="token operator">=</span> <span class="token function">Object</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span> <span class="token comment">// 值为原始值（数字，字符串，布尔值）的 this 会指向该原始值的实例对象</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">const</span> specialPrototype <span class="token operator">=</span> <span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token string">'特殊属性Symbol'</span><span class="token punctuation">)</span> <span class="token comment">// 用于临时储存函数</span>
    context<span class="token punctuation">[</span>specialPrototype<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span> <span class="token comment">// 函数的this指向隐式绑定到context上</span>
    <span class="token keyword">let</span> result <span class="token operator">=</span> context<span class="token punctuation">[</span>specialPrototype<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token operator">...</span>arr<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 通过隐式绑定执行函数并传递参数</span>
    <span class="token keyword">delete</span> context<span class="token punctuation">[</span>specialPrototype<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 删除上下文对象的属性</span>
    <span class="token keyword">return</span> result<span class="token punctuation">;</span> <span class="token comment">// 返回函数执行结果</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="判断函数的上下文对象"><a href="#判断函数的上下文对象" aria-hidden="true" class="header-anchor">#</a> 判断函数的上下文对象</h4> <p>很多人判断函数上下文对象，只是简单的以<code>context</code>是否为false来判断,比如：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 判断函数上下文绑定到`window`不够严谨</span>
context <span class="token operator">=</span> context <span class="token operator">?</span> <span class="token function">Object</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span> <span class="token punctuation">:</span> window<span class="token punctuation">;</span> 
context <span class="token operator">=</span> context <span class="token operator">||</span> window<span class="token punctuation">;</span> 
</code></pre></div><p>经过测试,以下三种为false的情况,函数的上下文对象都会绑定到<code>window上</code>：</p> <div class="language- extra-class"><pre class="language-text"><code>/ 网上的其他绑定函数上下文对象的方案: context = context || window; 
function handle(...params) {
    this.test = 'handle'
    console.log('params', this, ...params) // do some thing
}
handle.elseCall('') // window
handle.elseCall(0) // window
handle.elseCall(false) // window
</code></pre></div><p>而<code>call</code>则将函数的上下文对象会绑定到这些原始值的实例对象上：</p> <p><img src="data:image/png;base64,UklGRnwUAABXRUJQVlA4IHAUAABwWgCdASraAVwAPpFAm0klo6KhKXTbELASCWdu/Ewd8knS87t+Rr9st5gPOE9IH+q6Uz1E/6R/quBO/wWS9ebP7N2lf3r8pvO/w1+W/cH+5+vZ/YeQLnv/o+g/8b+xP5L+0/jv7Tf4rwX9839d6gv5N/J/9F6M3wH+q7SvOP209QL10+ef8D/B/kr5+v9x/UvUj8l/qH+x9wD+Q/0v/ReqH+D8Df67/if9p7gX8p/rP+9/wf5XfSv/F/+T/Nflr7Svz7/B/+D/MfAN/MP63/0P79/ne4l+6vssftZ//zn7vd0f7JZqIYnBl7xifn/ledNVyukzNYnoXKcd2wRZJozGhrbJyhKTqM4XeziIVk3Oqj8PGzJMEyVNpYK83w/CEet1eid+gFvqdpMuONcsOs3XoHIxYQubFK5d4rFdn9MZXEl0FEdCF8uDDXIeX7ygubc9+fXtZCnVW11oG6Lmx21VXQQxSAVhXBKBnG/AlQomqJ+LF1RSkkU5DlWt4DCnBazgSAqRaDe6sPHuBObRJ82hbdKpXiUrGeUIguFKUMpqyc+gVAXabY2n1R0PHqH1Jx4iC20a8Oc+x3nRVMViQaOz8j3695tL4zeq9+P44wiJ8yhGG/JkY3VDnCyx11Vxx9H5+C8vCfb5g4Y9gCLQNfiNibv3B37zkjZ7K9mxAA9RI2jtr+v9/XO/EOYRDPW05k0EFge68HFWKTm4GJdo4Lb2iLcynll0yS7m4XVi25WLn/NfhBehb1vwDY8ARnKCYUdA31ixBd7dAxggcCvop5vUvXwT7iNbCLXmhZwb4mMRznNCz2xYDAhRCSr9IH7p31rWz3nIU68nhMDRG2ueaOZVs+1OyyDawsF02An38STtNkOfrNuirUPDNpsTja58K1ziITVqUwdtexpmEzF22WIY/Sh51Qywqedv75h5x8ajA/WEWIQ3gUiSu/2DYwzpyfISubcvkJXOlVzbjQAA/vq5S+PIO9atut8RF8eA4PrjtA4Mf4/sKwuZcd1pE/7kDKORyFBHpuAQhycKf1y8+jkdMe0ugkeB8p3SojC+tXyXQUXZkTfobx/0UUYaXVVi/Dn/fg7C6iqLqUBmUbkkt3l1JO4F+V4UUsPLUtGEwM3DZp3YnVJ3Y47ZQP47Ic/wMHwntE9p2yhZKThe8OtYHcy+vM6P/ynNG6tiC3LhjCu/XRtoxf+afHFMyayU8pvA2u9K9kv4yEbs+ZN6f0q5dCCrsw8t0UUWEreYQtzFBx8dKTG1ksiPM3vhZUtkR19TdP/sJgFqdWCG1ZP4b4VDQNJ6qXHuCRNIrweJQVwCUZoHnxvaRWi3dam7R72Zg0FzLNWblHP1+31nzLCEK8AZz/1w+h+rq5ziJ3q72nEGpQYLxfvEgZAUazVDvJWUSZm8UzAEF3fpKsR/H0/DHC/OUW2dGyhk4sHcsGGe88IvfgT4fep75OsDj1EFsEC7RYyinXQAftvChYAykw2CvrclijwCspVK3/NwdetM+j/l1WZ55QSVM8MvrN+nF9xRjVlWGCenjjwBk1WIGPJZrEm26gTmMDMzw2dy8l1j3cNyPE8AtRPq3FvnR9DZsdPJJAOauS22iIzTeQBUBa+hr8TZqafotNWXMk9mgbgQeRG4XAzx4V5eWTNLMLG3+naJ+TCjGOfRo9ZqzczrethCqmR1hwFWxGusszm3jpL+Axhmbs7rimRLsjSepcuilX27aPRzzZvFIR/7Ei+/URrmVAwFCYdazhz5bLmF6Dp7a7dGNRAe9D9eh3yFP3+k0b3tl7v4q7FOH7pOH19ArjmN+RoLiknWJbGhyiLMVQCA75wqWdjty5MOiZJcVuqqbS1/h4MK9JXsKElONwUBejN+9v49EL1zeJyqP3xm/RikT9ykRkT+XF5Zg7MqC8jCZImm9OM8mu2UQPDLpyk/0RfSafsYrt9dRWa/xG0cHe8B2iXCw1lPIj7wb2eNTG1qN6Y6PmhFlJZVg+8a6Tj1hkkucWrf6Xt9gmsXqizRx0uO8MVilmJLHMbsrrBLLHzfmyo+2YuCFdqmRPAgUUqlcn4aJqxm0q0gGblBMsAPgBzYGM3I1Ckffz93R0kc+xwj2c9/kkxW25s4Jb8J3O6a98R0ULsEQ3HXtW0oB5bb6lTku8bM3EKSF7vMhfopGYbVAIgtkK9aLoNAAJFeBZcKJ4U62xpeL18dGgLxqkWkXTR8hDSXnFlxRD+xpQ7W3N2TvdVfDvNWRhsL3F5ruNEyblHtZjivVL7EQ4We5dOfiGj1Xvp9LWnfnGhwCvlT6DXs1W/hXPGiy2q8+i/j5uQiQjCxFoYHJN+SVc1FfwKg9mE0C83AeiaY8WN/+tk6aE3CES8qJCINlmhzM5IvOEzkuRraQ7cwwogFO6k+ZR8XHie6Gno4c5gf36wtK10HkBv5/XlNmMq2QYH/EV3rqs+vm73/eY1wL4tHw9H584nbfHPnSlYph/4qaoDhOBk8s+1c1hl5tPq/wTUJ+Db3GWvAccUK+xUaxK6DtAzg/izQdYttFRTJ/aJN14M8qyg7lj56uepyAzXiegsUJiZKScj7AmZKG8eksoAlpL0NjQFlqNb9R1qRjgJOw8JqhROCbIEAc6TDJwdBIP+1M8bagFWuooAAsWjtmoX6dk9Zb6+hd8Wx0EnFDwcmofH180+9cfEZZNnRY4Ol92ryFeZl/wVv4/fG9a3iFhLaUE1MY1M0XieEY0Eqah1sG/Z+YRImXZ6Uj6dBZH8LYXG1Wmetj7tHobwoVDmOmGlI1Pc7x5kELMT4jridgtEF8RjeHZzNAVMM36YL0iDPqE8fKyuy7uel2O86bUbAF2PpxtiFRzUYQSKzuMidW08mGPoe8vobHpB7AUd5fPezwRKB+FYHyhhfKs/K8J3j0cDYjtpnUbE4S1ahGhqpDzaIoMKvW469YNg4KCARF50gb4IfjXczr7iu7URtCsB3BZ1e3cTb3B26hwBOU/4gdN24Prxvwjx0mXTMTmtcBpNeZqHCYRd4BKYMO3lCrRm7Jj9pxrK6H4/X9EG+rBgP3gz9HJxyn8pI2r+IYu1Buw9bpnlOd9JzSjNyUheV8LwHLix4s8ABh2izBwPrq/VfnRZGKeOSh/kbfFYdh5Ds8Smef57qF1n2X76iIWgfzVVAh/MhDv9cIV9HmLiRMmV9qYxfotpsSXOQ3qjTnRh/dlsDthzkHqmxIv65UG8uC5MjQAD2BWMhcD8srZtScpFtLMjfoqo/a3ZmR1blS3Q/tZ4KPL8KVpOqi7UU3ggNV7iIxvkZAP/YAgCQNYRIR1xoG1OcdsokvjzWjrKZxcpGqKAxVUh+Kdzlcvg3rbiPFCj6NgHEEnv32zuxclIXhiQCmz68hDMsmZDJZjSltHOt0qTqdUGHPg2WQbyIWxcuTj7XDR2OgRx7D602zRUYDSxHLWcz0dJjy5xEhBz3dWIzdcI3hLenlWPcqWAsYavumTbvjEEeaA8s5ZJGVBV8j3mCjKtmkrhz5DvXEt9LSlOWNtcSMXl214mH5UBjnrQengTZj0zlDkXbL5XU2tqILvp7tIBUv8E0G2e3AHichq+RqXbEjYyfuTVW5hWnPfXB8SE/1ueh8aiHoeor9v/e3FDQj2pXFJVmrG07Pbgq6LS2lbe8bhjw+kEWQm2/lOtwYKgm1tSmeEY1dIK0HjZib8jDYQTLEbHnyP7ahDz0y6fy2K94JdxUilT5KlBDqTd/+HAcS2uzfW/zn1BShDPNJoaeUqH297XR0n/14Q8ZWRQGSbL4HfPWR6gm72bQQU0fq7oIltKviDUI4MXgVFlIgZAMgcUrg/eGXuft04f3bJCcdlbvsYPqCcGhFDO9zSCxU3k7aGd5oLr9U4ggwQzUiSIb27u8vRqP8iuvr/xBOIhVCRmOCqdWB4qBb2b5wnm+s/JOdcnacBmv3w2DdBtbPj9bAps1wVnabPJaKv1J5HAyR8WRseuG5Yuc4P7DARsH2fXR8nOZ75n3+Hg+ffwZ7JKlBeBXz6Z7yGQn8h9U9EAAjBuMgyWMNGbCo5DPiZoo87hTmG0djNQ0U1LrdxnajPFpwaE2MI2iGu2VV4DXXVKwFUCBPlO8XHK+QUBjVtgCgsahXIwpvF92Mn4ej2G9bgAN1Uy5FWYGH6g0tatwYC+JwG4dtkdmOOf+lEdTOaNe6vmoVit7K4T89OAvSiYWeC2eF2YL5+x9o8bIJ4KGkV5il4eNJht1ZHui8w7Io1VFdsGBUnLEIv6d7GEvxqAf0hChXUk9+Y1WkvIu0Zykq7iQBMPxOib10obzC538rgSALg0pDZZOzgziTla0juRffU9lpcyXt1RfC9sXrgNJD3Y4CvwojZJI6bKUXmd1EGohIuAjRjFkpHOp6epZpvq0p0kSbOQDDw/3QG8ektnY1WJVJw+LCWtSCBraMqHGtA4uedgjpFsr/KIzZBHe1xypDWN5PXPuhogXA9uN+JioT67I7J4TeYBqmABXXZBVPOy+h7ziSbNvLF13NhK1rsAsPDDvLvhb0zS8SfuJv9GYB4YKvfEAR2gBm5DG1FUvX4nUdb9TzfB81blCzxseErCTMbZJ0G3cbRgLPOGGRpDOu5MpX49gC8hRth2OpYRW725KIj4wteoDr5WUO8hvevxPs6nQjqScjjyaLPqVr+D204H6jZABySJGX/2IFpz9NKOJ69egtDPiZa9AGxE46UjYuk81lkLOWutWqCDiBNBvTjugLBkeKj/78ra/VMMjXaB0BnBR2zoJJoh7qcNScQ7FeOom5G9VAMmDMz77TSddY0ETpoNsCj/mfLcilt5JeHE+NsNmx1EcR1O49lsOvDcQitorIUiBNm1UAf3VNkACA+Tu0mFmwPAPYXxpdFkhucGBQ+hK5w5jSwjYXw4cggEbfBsq4HxHsn9ta9jEP8ruNUiyGpFhjqZypS54ZaMBFb5F3i7FfyDLcwEvqfXpII7BGnob1bORzGW9y6uSOM25OdXexys0OxlddxNItXjmgkWDcdoHBj/IY2f6he1tzdkXZgHbWVtMTv19F4XkvhuBmx+H6ZGom8jptM7mxApnfhbPrCDU2Mng0BH0QCA7cHNW4jkiVUqIaWYqniXYqhSAEDoziVNk4/cOskUZJrEfshTO+TbG5RRSvk8dGYuANXPYSLGJjXG+himjSueNtVXmWG7bnTTv8I9afs4IM8ChrNtgE4zXvyZn1a7FPngJq7KMTAz8ILItgN7dYF+uRwhJrtnBKE6J8sYy/fFBQE4aOqg932bYk8w6YfOh9OmAvbYB/24+wCttlT/MA3AGVYJBx9XQ9qdsxPrHERIOulhCqDgkC1utE9kTEf4/NIYwR6PLEoh2yHPVYSkAqjfFkoTvpGb4Y2shCsQPeKPSPLRvACy0Rn7oz49t6mIJf/eB98oOhVkADaD+hLrLhlBa2JJXV3E/ze/7Pn/jW19ZfmHsuj6aGzUX6zU0B868ITjCq4IEF0hh4Ajifoh/HZ16/E7vpzyoUlzSwjZ9cuWI0bHzjoMLjT+oIfLE6cDL4kiBz8CGltWOjAAmrS8cw10iiKEYmGzPoSNDhYYbDdVDjpGlUODSWjXJOKl7jHLFfBtbvjfl7ELJWWdjOKHjaDijWkdE0VMlmuaEO6EstDEdu+v4RCU61J5f511WZr336XPMvtOpBbLQO9jrhkudq5LBG/xYDVbNb5IY+GWedB1gQSB0o99o1SHCLi63BeTp0caErbPIGJWlWzZ2OnPCzNJNVjC+MV4kUTj0cS9NsW3o0QnyA0/Xc3AG67sY0BDMDDUlrBireNpS1kJ7rMB29AExjUshKRWCQYadYgAc6Y7yBZkiWR7cNfsd2I0nmkP2jsCE0C53RGe3Bo4YV4nf770UnfgTJgilUK70rLonYUe/1fIIAiS9NXb2BDiuAd4KXbFbaGuJxCg2C0rnFEFV46WpAq3Me2SISOqfPS0tMFTfoS536DFy9vfBh7dTXz3k9HRS8Kf0L289Y+AMRNpupVHpi6lOoe3jknaR/NOwq/dFFCN9QDs+RE+zARTOzGN5B1LBPnHSYJJF15wydAcrFKOB0cPQEVwF6fonBzbjDLGv+nN1lJZNSkmsDh6Pv7pW4KTwjnJXlXWbzYM6sOZdcn4jJSr/+BedrFi/4qXoCTvplvsTytgZRQx2+p5Xx2d8/gTM9psgk8IaJ51aOQvLyxy762ARSsS+LVz3uGg4ZLVsipZi6VKmC/pcLzKYKAs6EFdZq+wQ8OfKeKWwL/RapRbA72INaQZepk1i1CfJGKiRYGgxBdEvvjWg1fOyMM7AysDFvZ1HPd20R0tPO+ZP5+7eCPqOdGzoiBqDMgw2f5v/TY0qL8nSTf8b+HR7XPGbWiofU0QyQihLRKnd9dB2GSVbPMbklnGBjHCbWOcZnb4uAnsl2vjCr3khsLIQYgUfPfqLsVsNg5iJFeru9Eo2dB5RRrtAu8C403/JxdeoVawcF+J/omqyKtwvI7yZjzceK+64d0Nn2jUWCIindV1yKC4RawI038usoiUtyr9s+c8JQ9ePo5p0una8qxg2O3dtWhEv1EtghqjpcGwxk83JKwJBJzM/elydv97eRDP/NW+SN5oRnnV17+Y4bBZu11bKIp4xN0Aw6zSoVdneNB8FpkYB/YSJKA+ZmDAoApJe2DnVCS1r5ootHKkXBqmVQABxKvPAwBPMEWMoxNnRofQIaqXMfmPn9mBYhtnl9hlwmrv8yo3h6EzmfzIduWVw0Mi8PaNKjoARTsLHgSJHlawyHXtQdxMbiff1ZpCel3ZlAh5IZZfLBXEshSGcVs8xAfkmpg87SC7VzKuKDGp9SqwNCAfRo2KYCgNYHOlI8dsO/XnsSwgfTs6be9jeidxhdmb1GfVPMM9buue5MjRBtySKUmhAyjVSniTatRfs6hpZIATS817fFBVtGfajVdFYDXZgoAAAjyc+5ng7esBC1fwV6QgQkb6ClrUbgAAAAAA=" alt="">
所以正确的解决方案，应该是像我上面那么做：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 正确判断函数上下文对象</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>context <span class="token operator">===</span> <span class="token keyword">null</span> <span class="token operator">||</span> context <span class="token operator">===</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token comment">// 指定为 null 和 undefined 的 this 值会自动指向全局对象(浏览器中为window)</span>
        context <span class="token operator">=</span> window 
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        context <span class="token operator">=</span> <span class="token function">Object</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span> <span class="token comment">// 值为原始值（数字，字符串，布尔值）的 this 会指向该原始值的实例对象</span>
    <span class="token punctuation">}</span>
</code></pre></div><h4 id="使用symbol临时储存函数"><a href="#使用symbol临时储存函数" aria-hidden="true" class="header-anchor">#</a> 使用Symbol临时储存函数</h4> <p>尽管之前用的属性是<code>testFn</code>但不得不承认，还是有跟上下文对象的原属性冲突的风险,经网友提醒使用<code>Symbol</code>就不会出现冲突了。</p> <p>考虑兼容的话,还是用尽量特殊的属性，比如带上自己的<code>ID：OBKoro1TestFn</code>。</p> <h3 id="你能手写实现一个apply吗？"><a href="#你能手写实现一个apply吗？" aria-hidden="true" class="header-anchor">#</a> 你能手写实现一个apply吗？</h3> <h4 id="思路-2"><a href="#思路-2" aria-hidden="true" class="header-anchor">#</a> 思路</h4> <ol><li>传递给函数的参数处理，不太一样，其他部分跟call一样。</li> <li>apply接受第二个参数为类数组对象, 这里用了JavaScript权威指南中判断是否为类数组对象的方法。</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token class-name">Function</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">myApply</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">context</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>context <span class="token operator">===</span> <span class="token keyword">null</span> <span class="token operator">||</span> context <span class="token operator">===</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        context <span class="token operator">=</span> window <span class="token comment">// 指定为 null 和 undefined 的 this 值会自动指向全局对象(浏览器中为window)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        context <span class="token operator">=</span> <span class="token function">Object</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span> <span class="token comment">// 值为原始值（数字，字符串，布尔值）的 this 会指向该原始值的实例对象</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// JavaScript权威指南判断是否为类数组对象</span>
    <span class="token keyword">function</span> <span class="token function">isArrayLike</span><span class="token punctuation">(</span><span class="token parameter">o</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>o <span class="token operator">&amp;&amp;</span>                                    <span class="token comment">// o不是null、undefined等</span>
            <span class="token keyword">typeof</span> o <span class="token operator">===</span> <span class="token string">'object'</span> <span class="token operator">&amp;&amp;</span>                <span class="token comment">// o是对象</span>
            <span class="token function">isFinite</span><span class="token punctuation">(</span>o<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>                   <span class="token comment">// o.length是有限数值</span>
            o<span class="token punctuation">.</span>length <span class="token operator">&gt;=</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span>                        <span class="token comment">// o.length为非负值</span>
            o<span class="token punctuation">.</span>length <span class="token operator">===</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>o<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>    <span class="token comment">// o.length是整数</span>
            o<span class="token punctuation">.</span>length <span class="token operator">&lt;</span> <span class="token number">4294967296</span><span class="token punctuation">)</span>                  <span class="token comment">// o.length &lt; 2^32</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span>
        <span class="token keyword">else</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">const</span> specialPrototype <span class="token operator">=</span> <span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token string">'特殊属性Symbol'</span><span class="token punctuation">)</span> <span class="token comment">// 用于临时储存函数</span>
    context<span class="token punctuation">[</span>specialPrototype<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span> <span class="token comment">// 隐式绑定this指向到context上</span>
    <span class="token keyword">let</span> args <span class="token operator">=</span> arguments<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 获取参数数组</span>
    <span class="token keyword">let</span> result
    <span class="token comment">// 处理传进来的第二个参数</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 是否传递第二个参数</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token function">isArrayLike</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">TypeError</span><span class="token punctuation">(</span><span class="token string">'myApply 第二个参数不为数组并且不为类数组对象抛出错误'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            args <span class="token operator">=</span> Array<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span> <span class="token comment">// 转为数组</span>
            result <span class="token operator">=</span> context<span class="token punctuation">[</span>specialPrototype<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 执行函数并展开数组，传递函数参数</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        result <span class="token operator">=</span> context<span class="token punctuation">[</span>specialPrototype<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 执行函数 </span>
    <span class="token punctuation">}</span>
    <span class="token keyword">delete</span> context<span class="token punctuation">[</span>specialPrototype<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 删除上下文对象的属性</span>
    <span class="token keyword">return</span> result<span class="token punctuation">;</span> <span class="token comment">// 返回函数执行结果</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

</code></pre></div><h3 id="你能手写实现一个bind吗？"><a href="#你能手写实现一个bind吗？" aria-hidden="true" class="header-anchor">#</a> 你能手写实现一个bind吗？</h3> <h4 id="划重点"><a href="#划重点" aria-hidden="true" class="header-anchor">#</a> 划重点</h4> <p>手写<code>bind</code>是大厂中的一个高频的面试题，如果面试的中高级前端，只是能说出它们的区别，用法并不能脱颖而出，理解要有足够的深度才能抱得offer归！</p> <h4 id="思路-3"><a href="#思路-3" aria-hidden="true" class="header-anchor">#</a> 思路</h4> <ol><li><p>拷贝源函数:</p> <ul><li>通过变量储存源函数</li> <li>使用Object.create复制源函数的prototype给fToBind</li></ul></li> <li><p>返回拷贝的函数</p></li> <li><p>调用拷贝的函数：</p> <ul><li>new调用判断：通过instanceof判断函数是否通过new调用，来决定绑定的context</li> <li>绑定this+传递参数</li> <li>返回源函数的执行结果</li></ul></li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token class-name">Function</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">myBind</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">objThis<span class="token punctuation">,</span> <span class="token operator">...</span>params</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> thisFn <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span> <span class="token comment">// 存储源函数以及上方的params(函数参数)</span>
    <span class="token comment">// 对返回的函数 secondParams 二次传参</span>
    <span class="token keyword">let</span> <span class="token function-variable function">fToBind</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>secondParams</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'secondParams'</span><span class="token punctuation">,</span>secondParams<span class="token punctuation">,</span><span class="token operator">...</span>secondParams<span class="token punctuation">)</span>
        <span class="token keyword">const</span> isNew <span class="token operator">=</span> <span class="token keyword">this</span> <span class="token keyword">instanceof</span> <span class="token class-name">fToBind</span> <span class="token comment">// this是否是fToBind的实例 也就是返回的fToBind是否通过new调用</span>
        <span class="token keyword">const</span> context <span class="token operator">=</span> isNew <span class="token operator">?</span> <span class="token keyword">this</span> <span class="token punctuation">:</span> <span class="token function">Object</span><span class="token punctuation">(</span>objThis<span class="token punctuation">)</span> <span class="token comment">// new调用就绑定到this上,否则就绑定到传入的objThis上</span>
        <span class="token keyword">return</span> <span class="token function">thisFn</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> <span class="token operator">...</span>params<span class="token punctuation">,</span> <span class="token operator">...</span>secondParams<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 用call调用源函数绑定this的指向并传递参数,返回执行结果</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    fToBind<span class="token punctuation">.</span>prototype <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>thisFn<span class="token punctuation">.</span>prototype<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 复制源函数的prototype给fToBind</span>
    <span class="token keyword">return</span> fToBind<span class="token punctuation">;</span> <span class="token comment">// 返回拷贝的函数</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">9/23/2019, 7:00:00 PM</span></div></footer> <div class="right-group"><div class="item"><span class="title">关注作者公众号</span> <span class="desc">共走前端全栈之路</span> <img width="100%" src="/img/wechat.jpg" alt></div><div class="item"><span class="title">小助手</span> <span class="desc">扫二维码，回复’前端客栈‘进群学习</span> <img width="100%" src="/img/wechat-assistant.png" alt></div></div> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/web-inn/web/js-1.html" class="prev">原型与原型链详解</a></span> <span class="next"><a href="/web-inn/web/js-3.html">继承实现的几种方式</a>→
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/web-inn/assets/js/app.c8204003.js" defer></script><script src="/web-inn/assets/js/3.b3decb7d.js" defer></script><script src="/web-inn/assets/js/1.b7f29f9d.js" defer></script><script src="/web-inn/assets/js/10.12ba8c85.js" defer></script>
  </body>
</html>
